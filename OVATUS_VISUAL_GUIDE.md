# HÆ°á»›ng Dáº«n Visual - Cáº¥u TrÃºc Dá»¯ Liá»‡u OVatus

## ğŸ“Š SÆ¡ Äá»“ Cáº¥u TrÃºc Tá»•ng Thá»ƒ

### 1. Cáº¥u TrÃºc Thá»‡ Tá»¥c Dá»¯ Liá»‡u

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             OVATUS ULTRASOUND SEGMENTATION DATASET           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼           â–¼           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  mapping_normalized4.jsonl        â”‚
            â”‚  (Annotation file - 583 entries)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                                      â–¼
    US_map4/ (Image Root)              Patient Metadata
         â”‚                             (250+ bá»‡nh nhÃ¢n)
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                   â”‚
    â–¼                    â–¼                    â–¼        â–¼
[Patient_1]      [Patient_2]         [...]      [UNK_*]
    â”‚                â”‚
    â”œâ”€ image_1.jpg  â”œâ”€ image_1.jpg
    â”œâ”€ image_2.jpg  â”œâ”€ image_2.jpg
    â””â”€ image_*.jpg  â””â”€ ...

Total: ~2500 áº£nh (sau khi resize 128x128)
```

---

## ğŸ·ï¸ CÃ¡c Lá»›p Bá»‡nh LÃ½ - Chi Tiáº¿t TÆ°Æ¡ng á»¨ng

### Biá»ƒu Äá»“ PhÃ¢n Bá»‘ Lá»›p

```
    LABEL DISTRIBUTION (583 images)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                         â”‚
    â”‚  nang_da_thuy     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 26%  â”‚
    â”‚  nang_don_thuy    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 25% â”‚
    â”‚  u_dac            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 24%  â”‚
    â”‚  u_bi             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 20%    â”‚
    â”‚  nang_da_thuy_dac â–ˆâ–ˆâ–ˆ 5%                â”‚
    â”‚  nang_don_thuy_dac â–ˆâ–ˆ 5%                â”‚
    â”‚                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    âœ… COMMON (>100):        4 classes
    ğŸŸ¡ MEDIUM (50-99):       0 classes  
    ğŸŸ  RARE (20-49):         2 classes
    ğŸ”´ VERY RARE (<20):      0 classes
```

---

## ğŸ“ VÃ­ Dá»¥: CÃ¡ch Dá»¯ Liá»‡u ÄÆ°á»£c Tá»• Chá»©c

### VÃ­ Dá»¥ 1: áº¢nh ÄÆ¡n Giáº£n (1 loáº¡i bá»‡nh)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSONL Entry: Patient "167_Nguyá»…n Thá»‹ Hoa"       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ "patient_name": "167_Nguyá»…n Thá»‹ Hoa"            â”‚
â”‚ "images": [                                      â”‚
â”‚   {                                              â”‚
â”‚     "image_name": "b754...cf.jpg"               â”‚
â”‚     "imageWidth": 1136,                         â”‚
â”‚     "imageHeight": 852,                         â”‚
â”‚     "labels": ["nang_da_thuy"],                 â”‚
â”‚     "points": [                                  â”‚
â”‚       [                                          â”‚
â”‚         [857.62, 427.88],                       â”‚
â”‚         [841.58, 367.50],                       â”‚
â”‚         [813.28, 319.39],                       â”‚
â”‚         ... (10 Ä‘iá»ƒm khÃ¡c)                      â”‚
â”‚       ]                                          â”‚
â”‚     ]                                            â”‚
â”‚   }                                              â”‚
â”‚ ]                                                â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Xá»¬ LÃ THÃ€NH TENSOR PYTORCH
         
    Gá»‘c Image (1136Ã—852)
            â”‚
            â”œâ”€ Resize â†’ (128Ã—128)
            â”œâ”€ Normalize â†’ [0, 1]
            â””â”€ Transpose â†’ [C, H, W]
                    â”‚
                    â–¼
            Tensor [3, 128, 128]
            (RGB channels)
            
    Polygon annotation
            â”‚
            â”œâ”€ Váº½ polygon trÃªn mask
            â”œâ”€ Resize â†’ (128Ã—128)
            â””â”€ Chuyá»ƒn vá» binary
                    â”‚
                    â–¼
            Tensor [1, 128, 128]
            (mask cho label 0 - nang_da_thuy)
            
    Final output (cho má»—i image):
            â”‚
            â–¼
    (image_tensor, masks_tensor, file_path)
     [3,128,128]  [6,128,128]
```

---

### VÃ­ Dá»¥ 2: áº¢nh Phá»©c Táº¡p (2+ loáº¡i bá»‡nh)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSONL Entry: Patient "170_Nguyá»…n Thá»‹ Tháº£o"      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ "labels": ["u_bi", "u_bi"]                      â”‚
â”‚            â†‘         â†‘                           â”‚
â”‚       CÃ¹ng má»™t lá»›p, 2 khá»‘i khÃ¡c nhau            â”‚
â”‚                                                  â”‚
â”‚ "points": [                                      â”‚
â”‚   [[522.71, 350.52], [530.26, 308.07], ...],   â”‚
â”‚   [[651.01, 508.07], [687.81, 570.33], ...]    â”‚
â”‚ ]                                                â”‚
â”‚       â†‘                    â†‘                     â”‚
â”‚    Polygon 1           Polygon 2                â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Xá»¬ LÃ MULTI-INSTANCE
         
    Polygon 1 â†’ Mask 1 [128, 128]
            â”‚
            â”œâ”€ numpy.maximum()  â† OR operation
            â”‚
    Polygon 2 â†’ Mask 2 [128, 128]
            â”‚
            â–¼
    Combined Mask [128, 128]
    (táº¥t cáº£ khá»‘i u_bi á»Ÿ lá»›p 4)
    
    Label 4 (u_bi):
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
    â”‚ â–‘â–‘â–‘ â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚  â–ˆâ–ˆâ–ˆ = Khá»‘i 1
    â”‚ â–‘â–‘â–‘ â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
    â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
    â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚  â–ˆâ–ˆâ–ˆ = Khá»‘i 2
    â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
    â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### VÃ­ Dá»¥ 3: áº¢nh Multi-Label (nhiá»u loáº¡i bá»‡nh)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JSONL Entry: Patient "259_..."                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚ "labels": [                                      â”‚
â”‚   "nang_da_thuy",         â† Label 0             â”‚
â”‚   "nang_da_thuy_dac",     â† Label 2             â”‚
â”‚   "u_dac"                 â† Label 5             â”‚
â”‚ ]                                                â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         OUTPUT MASKS [6, 128, 128]
         
    Mask[0] = nang_da_thuy       (cÃ³ dá»¯ liá»‡u)
    Mask[1] = nang_don_thuy      (0 - khÃ´ng cÃ³)
    Mask[2] = nang_da_thuy_dac   (cÃ³ dá»¯ liá»‡u)
    Mask[3] = nang_don_thuy_dac  (0 - khÃ´ng cÃ³)
    Mask[4] = u_bi               (0 - khÃ´ng cÃ³)
    Mask[5] = u_dac              (cÃ³ dá»¯ liá»‡u)
    
    Kháº£ nÄƒng Overlap:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Náº¿u mask[0] + mask[2] > 1:         â”‚
    â”‚  â†’ CÃ³ pixels thuá»™c cáº£ 2 lá»›p          â”‚
    â”‚  â†’ KhÃ´ng thá»ƒ dÃ¹ng SOFTMAX           â”‚
    â”‚  â†’ Pháº£i dÃ¹ng SIGMOID                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ SÆ¡ Äá»“ Pipeline Xá»­ LÃ½ Äáº§u TÃ­nh Äáº¿n Cuá»‘i

```
                    START
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  mapping_normalized4    â”‚
         â”‚     .jsonl              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Parse JSON Line        â”‚
         â”‚  Extract patient_name   â”‚
         â”‚  Extract image metadata â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  TÃ¬m file áº£nh           â”‚
         â”‚  {DATA_ROOT}/           â”‚
         â”‚  {patient_name}/        â”‚
         â”‚  {image_name}           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼          â–¼
    [Load Image]  [Check]
    Convert RGB   File exists?
    Resize 128x   â”‚
         128      â”œâ”€ No â†’ Skip
    Normalize     â”‚
         [0,1]    â””â”€ Yes â†“
         â”‚            â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  For each Label/Polygon â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                      â–¼
    Check polygon        Create mask from
    validity (â‰¥3 pts)    polygon points
         â”‚                    â”‚
         â”œâ”€ Invalid â†’ Skip   â”‚
         â”‚                   â–¼
         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚ Váº½ polygon   â”‚
         â”‚            â”‚ PIL.Draw     â”‚
         â”‚            â”‚ Resize mask  â”‚
         â”‚            â”‚ NEAREST      â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”‚                    â–¼
         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚ Merge masks  â”‚
         â”‚            â”‚ (OR operation)
         â”‚            â”‚ if multi-    â”‚
         â”‚            â”‚ instance     â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Image ready? Masks OK?  â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  Both Yes â†’ Add sample  â”‚
        â”‚  Any No â†’ Skip          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
      self.samples.append(
        (img_tensor, masks_tensor, path)
      )
              â”‚
              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Láº·p Ä‘áº¿n háº¿t file JSONL â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         FINISH
      (583 samples)
```

---

## ğŸ“Š Biá»ƒu Äá»“ Táº§n Suáº¥t NhÃ£n Chi Tiáº¿t

```
FREQUENCY DISTRIBUTION BY RARITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸŸ¢ COMMON (â‰¥100 images):
   â”œâ”€ u_dac              137 â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…  (23.5%)
   â”œâ”€ nang_da_thuy       151 â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…  (25.9%)
   â”œâ”€ nang_don_thuy      148 â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…  (25.4%)
   â””â”€ u_bi               116 â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…    (19.9%)

ğŸŸ  RARE (20-99 images):
   â”œâ”€ nang_don_thuy_dac   30 â–…â–…â–…               (5.1%)
   â””â”€ nang_da_thuy_dac    31 â–…â–…â–…               (5.3%)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Total: 613 áº£nh (583 unique + multi-label)
```

---

## ğŸ¯ LÆ°u LÆ°á»£ng Dá»¯ Liá»‡u Qua CÃ¡c Giai Äoáº¡n

```
Input JSONL
    â”‚
    â”œâ”€ Total lines: 250+ bá»‡nh nhÃ¢n
    â”‚
    â”œâ”€ Total images: ~2500 áº£nh gá»‘c
    â”‚
    â”œâ”€ After filtering (invalid):
    â”‚  â””â”€ Valid images: 583 áº£nh âœ…
    â”‚
    â””â”€ Output Dataset:
       â”œâ”€ Size in memory: ~300 MB
       â”‚  (583 Ã— 3 Ã— 128 Ã— 128 Ã— 4 bytes)
       â”‚
       â”œâ”€ Split 60/20/20 (patient-level):
       â”‚  â”œâ”€ Support: 336 áº£nh (60%)
       â”‚  â”œâ”€ Dev:     113 áº£nh (20%)
       â”‚  â””â”€ Test:    134 áº£nh (20%)
       â”‚
       â””â”€ Ready for training: âœ…
```

---

## ğŸ” CÃ¡c Kiá»ƒm Tra Cháº¥t LÆ°á»£ng Dá»¯ Liá»‡u

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DATA QUALITY CHECKS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ 1. File tá»“n táº¡i?                   â”‚
â”‚    âœ… Kiá»ƒm tra path                 â”‚
â”‚    âš ï¸  Skip náº¿u missing             â”‚
â”‚                                     â”‚
â”‚ 2. Polygon há»£p lá»‡?                 â”‚
â”‚    âœ… Ãt nháº¥t 3 Ä‘iá»ƒm                â”‚
â”‚    âš ï¸  Skip náº¿u < 3 Ä‘iá»ƒm            â”‚
â”‚                                     â”‚
â”‚ 3. áº¢nh load Ä‘Æ°á»£c?                  â”‚
â”‚    âœ… RGB conversion OK              â”‚
â”‚    âš ï¸  Skip náº¿u corrupt             â”‚
â”‚                                     â”‚
â”‚ 4. Resize thÃ nh cÃ´ng?               â”‚
â”‚    âœ… 128x128 OK                    â”‚
â”‚    âš ï¸  Skip náº¿u lá»—i                 â”‚
â”‚                                     â”‚
â”‚ 5. CÃ³ mask há»£p lá»‡?                 â”‚
â”‚    âœ… Ãt nháº¥t 1 mask > 10 pixels    â”‚
â”‚    âš ï¸  Skip náº¿u táº¥t cáº£ 0            â”‚
â”‚                                     â”‚
â”‚ 6. Overlap check?                  â”‚
â”‚    âœ… Report náº¿u pixels chá»“ng      â”‚
â”‚    âš ï¸  Log warning nhÆ°ng váº«n láº¥y   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: 583/~2500 = 23.3% valid
```

---

## ğŸ“ Báº£ng So SÃ¡nh CÃ¡c Lá»›p

```
â•”â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ID â•‘ TÃªn (Tiáº¿ng Viá»‡t)    â•‘ Sample â•‘ Percentage â•‘ Status       â•‘
â• â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ 0  â•‘ Nang Äa NÆ°á»›c        â•‘  151   â•‘   25.9%    â•‘ âœ… COMMON    â•‘
â•‘ 1  â•‘ Nang ÄÆ¡n NÆ°á»›c       â•‘  148   â•‘   25.4%    â•‘ âœ… COMMON    â•‘
â•‘ 2  â•‘ Nang Äa NÆ°á»›c Äáº·c    â•‘   31   â•‘    5.3%    â•‘ ğŸŸ  RARE      â•‘
â•‘ 3  â•‘ Nang ÄÆ¡n NÆ°á»›c Äáº·c   â•‘   30   â•‘    5.1%    â•‘ ğŸŸ  RARE      â•‘
â•‘ 4  â•‘ U LÃ nh (Benign)     â•‘  116   â•‘   19.9%    â•‘ âœ… COMMON    â•‘
â•‘ 5  â•‘ U Ãc (Solid)        â•‘  137   â•‘   23.5%    â•‘ âœ… COMMON    â•‘
â•šâ•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Tá»•ng cá»™ng: 613 annotations (583 unique images)
Báº£ng CÃ¢n Báº±ng: TÆ°Æ¡ng Ä‘á»‘i cÃ¢n báº±ng
```

---

## ğŸ› ï¸ CÃ¡c BÆ°á»›c Tiá»n Xá»­ LÃ½ Chi Tiáº¿t

```
PREPROCESSING PIPELINE

1. IMAGE PROCESSING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Original Image (1136Ã—852)       â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚
   â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚
   â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘ [Ultrasound] â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚
   â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Resize (BILINEAR)
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Resized Image (128Ã—128)         â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘ [US] â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Normalize Ã·255
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Normalized RGB [0, 1]           â”‚
   â”‚ Shape: (3, 128, 128)            â”‚
   â”‚ Dtype: float32                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. MASK PROCESSING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Polygon Points (2D)             â”‚
   â”‚ [[x1,y1], [x2,y2], ...]        â”‚
   â”‚ On image (1136Ã—852)             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ PIL.Draw
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Full Mask (1136Ã—852)            â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Resize (NEAREST)
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Resized Mask (128Ã—128)          â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Binary [0, 1]
                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Label Mask (float32)            â”‚
   â”‚ Shape: (128, 128)               â”‚
   â”‚ Values: 0.0 or 1.0              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. STACKING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ For each label (6 total):       â”‚
   â”‚                                 â”‚
   â”‚ Label 0 mask (128, 128)         â”‚
   â”‚ Label 1 mask (128, 128)         â”‚
   â”‚ ...                             â”‚
   â”‚ Label 5 mask (128, 128)         â”‚
   â”‚                                 â”‚
   â”‚ np.stack() â†’ (6, 128, 128)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Cáº¥u TrÃºc Bá»™ Nhá»› Má»™t Máº«u

```
ONE SAMPLE MEMORY LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Image Tensor: [3, 128, 128]
â”œâ”€ Channel 0 (Red):    128Ã—128 Ã— 4 bytes = 65,536 bytes
â”œâ”€ Channel 1 (Green):  128Ã—128 Ã— 4 bytes = 65,536 bytes
â””â”€ Channel 2 (Blue):   128Ã—128 Ã— 4 bytes = 65,536 bytes
   Total: 196,608 bytes = ~192 KB

Masks Tensor: [6, 128, 128]
â”œâ”€ Label 0: 128Ã—128 Ã— 4 bytes = 65,536 bytes
â”œâ”€ Label 1: 128Ã—128 Ã— 4 bytes = 65,536 bytes
â”œâ”€ Label 2: 128Ã—128 Ã— 4 bytes = 65,536 bytes
â”œâ”€ Label 3: 128Ã—128 Ã— 4 bytes = 65,536 bytes
â”œâ”€ Label 4: 128Ã—128 Ã— 4 bytes = 65,536 bytes
â””â”€ Label 5: 128Ã—128 Ã— 4 bytes = 65,536 bytes
   Total: 1,179,648 bytes = ~1.1 MB

String path: ~100 bytes

ONE SAMPLE TOTAL: ~1.3 MB

ENTIRE DATASET (583 samples): ~760 MB
```

---

## âœ… Checklist Kiá»ƒm Tra Dá»¯ Liá»‡u

```
â–¡ Annotation file tá»“n táº¡i?
  â””â”€ mapping_normalized4.jsonl

â–¡ Image folder tá»“n táº¡i?
  â””â”€ US_map4/

â–¡ JSONL parse Ä‘Æ°á»£c?
  â””â”€ No encoding errors?

â–¡ Táº¥t cáº£ file image tá»“n táº¡i?
  â””â”€ ~583/~2500 = 23.3% âœ…

â–¡ Polygon data há»£p lá»‡?
  â””â”€ Ãt nháº¥t 3 Ä‘iá»ƒm

â–¡ Mask generation OK?
  â””â”€ PIL.Draw works?

â–¡ Tensor shapes Ä‘Ãºng?
  â””â”€ Image: [3, 128, 128]
  â””â”€ Masks: [6, 128, 128]

â–¡ Dtype Ä‘Ãºng?
  â””â”€ float32 âœ…

â–¡ Value ranges OK?
  â””â”€ Image: [0.0, 1.0] âœ…
  â””â”€ Masks: [0.0, 1.0] âœ…

â–¡ Multi-instance handling?
  â””â”€ OR operation (maximum) âœ…

â–¡ Class distribution reasonable?
  â””â”€ No extreme imbalance âœ…

â–¡ Overlap analysis done?
  â””â”€ Multi-label confirmed âœ…
```

---

**Version**: 1.0
**Purpose**: Visual guide for OVatus dataset structure
**Last Updated**: December 2025
